import{r as l,j as e,R,a as A}from"./client-D_PkVYew.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const C=async a=>{if(a.status===401)return window.location.href="/login",null;if(!a.ok){const c=await a.json().catch(()=>({})),d=c.header?.rtmsg||c.message||`HTTP ${a.status}: ${a.statusText}`;throw new Error(d)}try{const c=await a.json();if(c.header&&c.header.rtcd!=="S00")throw new Error(c.header.rtmsg||"ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");return c.body||c}catch(c){throw c.message!=="ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"?c:new Error("ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}},I={async getCart(){try{const a=await fetch("/cart",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});return await C(a)}catch(a){throw console.error("ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ ì‹¤íŒ¨:",a),a}},async updateQuantity(a,c,d){try{const o=await fetch("/cart/quantity",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({productId:a,optionType:c,quantity:d})});return await C(o)}catch(o){throw console.error("ìˆ˜ëŸ‰ ë³€ê²½ ì‹¤íŒ¨:",o),o}},async removeFromCart(a,c){try{const d=await fetch("/cart/remove",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({productId:a,optionType:c})});return await C(d)}catch(d){throw console.error("ìƒí’ˆ ì‚­ì œ ì‹¤íŒ¨:",d),d}},async addToCart(a,c,d){try{const o=document.querySelector('meta[name="_csrf"]')?.getAttribute("content"),n=document.querySelector('meta[name="_csrf_header"]')?.getAttribute("content"),i={"Content-Type":"application/json",Accept:"application/json"};o&&n&&(i[n]=o);const p=await fetch("/cart/add",{method:"POST",headers:i,credentials:"include",body:JSON.stringify({productId:parseInt(a),optionType:c,quantity:parseInt(d)})});return await C(p)}catch(o){throw console.error("ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨:",o),o}}},D=l.memo(({item:a,selected:c,onSelect:d,onQuantityChange:o,onRemove:n,updating:i=!1})=>{const[p,m]=l.useState(!1);l.useCallback(async s=>{if(!(s<1||p||i)){m(!0);try{await o(a.productId,a.optionType,s)}catch(h){console.error("ìˆ˜ëŸ‰ ë³€ê²½ ì‹¤íŒ¨:",h),alert("ìˆ˜ëŸ‰ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}finally{m(!1)}}},[a.productId,a.optionType,o,p,i]);const S=l.useCallback(async()=>{if(!(p||i)&&confirm("í•´ë‹¹ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){m(!0);try{await n(a.productId,a.optionType)}catch(s){console.error("ì‚­ì œ ì‹¤íŒ¨:",s),alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}finally{m(!1)}}},[a.productId,a.optionType,n,p,i]),N=l.useCallback(s=>{d(a.productId,a.optionType,s)},[a.productId,a.optionType,d]),{productName:u,description:E,price:g,originalPrice:x,quantity:T,optionType:$,productImage:w,sellerNickname:j,available:y=!0}=a,f=g*T,v=x&&x>g,t=p||i||!y,r=p||i;return e.jsxs("div",{className:`cart-item ${c?"selected":""} ${p?"updating":""} ${y?"":"unavailable"}`,children:[e.jsx("input",{type:"checkbox",checked:c,onChange:s=>N(s.target.checked),disabled:t,className:"item-checkbox"}),e.jsxs("div",{className:"item-image",children:[w?e.jsx("img",{src:w,alt:u,loading:"lazy",onError:s=>{s.target&&(s.target.style.display="none",s.target.nextSibling&&(s.target.nextSibling.style.display="block"))}}):e.jsx("div",{className:"no-image",children:"ì´ë¯¸ì§€ ì—†ìŒ"}),!y&&e.jsx("div",{className:"sold-out-status",children:"í’ˆì ˆ"})]}),e.jsxs("div",{className:"item-info",children:[e.jsx("div",{className:"item-title",children:u}),e.jsxs("div",{className:"item-seller",children:["íŒë§¤ì: ",j||"íŒë§¤ì"]}),e.jsxs("div",{className:"item-option",children:["ì˜µì…˜: ",$]})]}),e.jsxs("div",{className:"item-price-info",children:[v&&e.jsxs("div",{className:"item-original-price",children:[x?.toLocaleString(),"ì›"]}),e.jsxs("div",{className:"item-price",children:[f?.toLocaleString(),"ì›"]})]}),e.jsx("button",{onClick:S,disabled:r,className:"remove-btn",title:"ì‚­ì œ",type:"button",children:p?e.jsx("div",{className:"button-spinner"}):e.jsx("i",{className:"fas fa-times"})})]})});D.displayName="CartItem";function q(){const[a,c]=l.useState(null),[d,o]=l.useState(null),[n,i]=l.useState(new Set),[p,m]=l.useState(!1),[S,N]=l.useState(!0);l.useEffect(()=>{u()},[]);const u=l.useCallback(async()=>{try{o(null),N(!0),console.log("ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ìš”ì²­ ì‹œì‘...");const t=await I.getCart();if(console.log("ğŸ“¦ ì¥ë°”êµ¬ë‹ˆ ì‘ë‹µ ë°ì´í„°:",t),t&&t.success)if(console.log("âœ… ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ì„±ê³µ:",t),c(t),t.cartItems&&t.cartItems.length>0){const r=t.cartItems.filter(s=>s.available).map(s=>`${s.productId}-${s.optionType}`);i(new Set(r))}else i(new Set);else console.log("âŒ ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ì‹¤íŒ¨:",t),o("ì¥ë°”êµ¬ë‹ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}catch(t){console.log("ğŸš¨ ì¥ë°”êµ¬ë‹ˆ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:",t),o("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{N(!1)}},[]),E=l.useCallback(async(t,r,s)=>{try{m(!0);const h=await I.updateQuantity(t,r,s);h&&h.success?(await u(),window.updateCartCount&&await window.updateCartCount()):alert(h?.message||"ìˆ˜ëŸ‰ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch{alert("ìˆ˜ëŸ‰ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{m(!1)}},[u]),g=l.useCallback(async(t,r)=>{try{m(!0);const s=await I.removeFromCart(t,r);s&&s.success?(await u(),i(h=>{const b=new Set(h);return b.delete(`${t}-${r}`),b}),window.updateCartCount&&await window.updateCartCount()):alert(s?.message||"ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch{alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{m(!1)}},[u]),x=l.useCallback((t,r,s)=>{const h=`${t}-${r}`;i(b=>{const k=new Set(b);return s?k.add(h):k.delete(h),k})},[]),T=l.useCallback(t=>{if(t){const r=a?.cartItems?.filter(s=>s.available).map(s=>`${s.productId}-${s.optionType}`)||[];i(new Set(r))}else i(new Set)},[a?.cartItems]),$=l.useCallback(async()=>{if(n.size===0){alert("ì‚­ì œí•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}if(confirm(`${n.size}ê°œ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{m(!0);for(const t of n){const[r,s]=t.split("-");await I.removeFromCart(parseInt(r),s)}await u(),i(new Set),window.updateCartCount&&await window.updateCartCount(),alert(`${n.size}ê°œ ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch{alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{m(!1)}},[n,u]),w=l.useCallback(async()=>{const t=a?.cartItems?.filter(r=>r.available&&n.has(`${r.productId}-${r.optionType}`))||[];if(t.length===0){alert("ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”");return}try{sessionStorage.setItem("selectedCartItems",JSON.stringify(t)),window.location.href="/order"}catch{alert("ì£¼ë¬¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}},[a?.cartItems,n]),j=a?.cartItems||[],y=j.filter(t=>t.available),f=j.filter(t=>t.available&&n.has(`${t.productId}-${t.optionType}`)),v=y.length>0&&n.size===y.length;return S?e.jsx("div",{className:"react-cart-content",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"custom-spinner"}),e.jsx("div",{className:"loading-text",children:"ì¥ë°”êµ¬ë‹ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}):d?e.jsx("div",{className:"cart-container",children:e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),e.jsx("p",{children:d}),e.jsx("button",{onClick:u,className:"order-button",children:"ë‹¤ì‹œ ì‹œë„"})]})}):a?.empty?e.jsxs("div",{className:"empty-cart-content",children:[e.jsx("div",{className:"empty-cart-icon",children:e.jsx("i",{className:"fas fa-shopping-cart cart-icon"})}),e.jsx("div",{className:"empty-cart-title",children:"ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤"}),e.jsx("a",{href:"/product/list",className:"shop-button",children:"ì‡¼í•‘í•˜ëŸ¬ ê°€ê¸°"})]}):e.jsxs("div",{className:"react-cart-content",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/product/list",className:"continue-shopping-btn",children:"< ê³„ì† ì‡¼í•‘í•˜ê¸°"})}),e.jsxs("div",{className:`select-all-section ${v?"":"unselected"}`,children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:t=>T(t.target.checked),className:"custom-checkbox"}),e.jsxs("span",{className:"select-all-text",children:["ì „ì²´ì„ íƒ(",n.size,"/",y.length,")"]})]}),e.jsx("div",{className:"select-actions",children:e.jsx("button",{onClick:$,disabled:n.size===0||p,className:"delete-selected-btn",children:"ì„ íƒì‚­ì œ"})})]}),j.map(t=>e.jsx(D,{item:t,selected:n.has(`${t.productId}-${t.optionType}`),onSelect:x,onQuantityChange:E,onRemove:g,updating:p},`${t.productId}-${t.optionType}`)),e.jsxs("div",{className:"order-summary",children:[e.jsxs("div",{className:"summary-title",children:[e.jsx("i",{className:"fas fa-file-alt"}),"ì£¼ë¬¸ìš”ì•½"]}),e.jsx("div",{className:"summary-section",children:e.jsxs("div",{className:"summary-label",children:["ì„ íƒëœ ìƒí’ˆ",e.jsxs("span",{className:"selected-count",children:[f.length,"ê°œ"]})]})}),e.jsx("div",{className:"price-list",children:f.map(t=>e.jsxs("div",{className:"price-item",children:[e.jsxs("div",{className:"price-item-info",children:[e.jsx("div",{className:"price-item-name",children:t.productName}),e.jsx("div",{className:"price-item-type",children:t.optionType})]}),e.jsxs("span",{className:"price-item-amount",children:[(t.price*t.quantity).toLocaleString(),"ì›"]})]},`item-${t.productId}-${t.optionType}`))}),e.jsxs("div",{className:"total-amount",children:[e.jsx("span",{className:"total-label",children:"ì´ ê²°ì œ ê¸ˆì•¡"}),e.jsxs("span",{className:"total-price",children:[f.reduce((t,r)=>t+r.price*r.quantity,0)?.toLocaleString(),"ì›"]})]}),e.jsx("div",{className:"download-notice",children:"â€» íŒŒì¼ì€ ê²°ì œ í›„ 7ì¼ê°„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤."}),e.jsx("button",{onClick:w,className:"order-button",disabled:f.length===0||p,children:p?e.jsx("div",{className:"button-spinner"}):`${f.length}ê°œ ìƒí’ˆ ì£¼ë¬¸í•˜ê¸°`})]})]})}R.createRoot(document.getElementById("cart-root")).render(e.jsx(A.StrictMode,{children:e.jsx(q,{})}));
