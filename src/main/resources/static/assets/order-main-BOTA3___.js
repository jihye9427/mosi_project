import{r as p,j as e,R as F,a as z}from"./client-D_PkVYew.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const v=async a=>{if(a.status===401)return window.location.href="/login",null;try{const s=await a.json();if(s.header&&s.header.rtcd!=="S00")throw new Error(s.header.rtmsg||"ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");return s.body||s}catch(s){throw s.message!=="ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"?s:(console.error("JSON íŒŒì‹± ì˜¤ë¥˜:",s),new Error("ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"))}},g=(a,s)=>{throw console.error(`${s} ì‹¤íŒ¨:`,a),a},q={async getOrderInfo(){try{const a=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await v(a)}catch(a){g(a,"ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ")}},async createOrder(a){try{const s=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await v(s)}catch(s){g(s,"ì£¼ë¬¸ ìƒì„±")}},async processPayment(a){try{const s=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await v(s)}catch(s){g(s,"ê²°ì œ ì²˜ë¦¬")}},async getOrderDetail(a){try{const s=await fetch(`/order/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await v(s)}catch(s){g(s,"ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ")}},async cancelOrder(a,s){try{const c=await fetch(`/order/${a}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s})});return await v(c)}catch(c){g(c,"ì£¼ë¬¸ ì·¨ì†Œ")}}};function b({name:a,value:s,checked:c,onChange:d,children:h}){return e.jsxs("div",{className:`payment-option ${c?"selected":""}`,onClick:()=>d(s),children:[e.jsx("input",{type:"radio",name:a,value:s,checked:c,onChange:()=>d(s),className:"payment-radio"}),e.jsx("div",{className:"payment-content",children:e.jsx("div",{className:"payment-label",children:h})})]})}function H({productName:a,price:s,quantity:c,optionType:d,sellerNickname:h,productImage:l,originalPrice:n}){return console.log("ğŸ–¼ï¸ OrderItem ì´ë¯¸ì§€ ë°ì´í„°:",a,"â†’",l?"Base64 ìˆìŒ":"null/undefined"),e.jsxs("div",{className:"order-item",children:[e.jsxs("div",{className:"order-item-image",children:[l?e.jsx("img",{src:l,alt:a,loading:"lazy",onError:x=>{console.log("âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:",a,"â†’",l),x.target.style.display="none",x.target.nextSibling.style.display="block"}}):e.jsx("div",{className:"no-image",children:"ì´ë¯¸ì§€ ì—†ìŒ"}),e.jsx("div",{className:"no-image",style:{display:"none"},children:"ì´ë¯¸ì§€ ì—†ìŒ"})]}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:a}),e.jsxs("div",{className:"order-item-option",children:["ì˜µì…˜: ",d]}),e.jsxs("div",{className:"order-item-seller",children:["íŒë§¤ì: ",h||"íŒë§¤ì"]})]}),e.jsxs("div",{className:"order-item-price",children:[n&&n!==s&&e.jsxs("span",{className:"original-price",children:[(n*c).toLocaleString(),"ì›"]}),e.jsxs("span",{className:"sale-price",children:[(s*c).toLocaleString(),"ì›"]})]})]})}function K({orderItems:a=[],memberInfo:s={},onSubmit:c,paymentMethod:d,onPaymentMethodChange:h,onRequirementsChange:l}){const[n,x]=p.useState({ordererName:s.name||"",phone:s.phone||"",email:s.email||"",requirements:""}),S=(t,y)=>{x(C=>({...C,[t]:y})),l&&l(y)},u=t=>{if(t.preventDefault(),!n.ordererName||!n.phone||!n.email){alert("í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(!d){alert("ê²°ì œìˆ˜ë‹¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}c({...n,items:a})};return e.jsxs("form",{onSubmit:u,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"ì£¼ë¬¸ì ì •ë³´"]}),e.jsxs("div",{className:"form-section-content",children:[e.jsx("div",{className:"order-info-item",children:e.jsxs("div",{className:"order-info-content",children:[e.jsx("div",{className:"order-info-label",children:"ì£¼ë¬¸ìëª…"}),e.jsx("div",{className:"order-info-value",children:n.ordererName||"ì •ë³´ ì—†ìŒ"})]})}),e.jsx("div",{className:"order-info-item",children:e.jsxs("div",{className:"order-info-content",children:[e.jsx("div",{className:"order-info-label",children:"ì—°ë½ì²˜"}),e.jsx("div",{className:"order-info-value",children:n.phone||"ì •ë³´ ì—†ìŒ"})]})}),e.jsx("div",{className:"order-info-item",children:e.jsxs("div",{className:"order-info-content",children:[e.jsx("div",{className:"order-info-label",children:"ì´ë©”ì¼"}),e.jsx("div",{className:"order-info-value",children:n.email||"ì •ë³´ ì—†ìŒ"})]})}),e.jsx("div",{className:"order-info-item",children:e.jsxs("div",{className:"order-info-content",children:[e.jsx("div",{className:"order-info-label",children:"ìš”ì²­ì‚¬í•­"}),e.jsxs("div",{className:"order-info-value",children:[e.jsx("textarea",{placeholder:"ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”(50ì ì´ë‚´)",value:n.requirements,onChange:t=>S("requirements",t.target.value),className:"form-textarea requirements-textarea",rows:"2",maxLength:50}),e.jsxs("div",{className:"character-counter",children:[e.jsxs("span",{className:n.requirements.length>50?"error":"",children:[n.requirements.length,"/50ì"]}),n.requirements.length>50&&e.jsx("span",{className:"error-message",children:"50ìë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."})]})]})]})})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"ê²°ì œìˆ˜ë‹¨"]}),e.jsx("div",{className:"form-section-content",children:e.jsxs("div",{className:"payment-options",children:[e.jsx(b,{name:"payment",value:"card",checked:d==="card",onChange:t=>{h(t),window.processPaymentImmediately&&window.processPaymentImmediately(t)},children:"ì‹ ìš©ì¹´ë“œ / ì²´í¬ì¹´ë“œ"}),e.jsx(b,{name:"payment",value:"bank",checked:d==="bank",onChange:t=>{h(t),window.processPaymentImmediately&&window.processPaymentImmediately(t)},children:"ë¬´í†µì¥ì…ê¸ˆ"}),e.jsx(b,{name:"payment",value:"simple",checked:d==="simple",onChange:t=>{h(t),window.processPaymentImmediately&&window.processPaymentImmediately(t)},children:"ê°„í¸ê²°ì œ"})]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"ì£¼ë¬¸ìƒí’ˆ(",a.length,"ê°œ)"]}),e.jsx("div",{className:"form-section-content",children:a.length>0?a.map((t,y)=>e.jsx(H,{productName:t.productName,price:t.price,quantity:t.quantity,optionType:t.optionType,sellerNickname:t.sellerNickname,productImage:t.productImage,originalPrice:t.originalPrice},y)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"ì¥ë°”êµ¬ë‹ˆë¡œ ëŒì•„ê°€ê¸°"})]})})]})]})}function Q({items:a=[]}){const s=a.length,c=a.reduce((l,n)=>l+(n.originalPrice||n.price)*n.quantity,0),d=a.reduce((l,n)=>l+n.price*n.quantity,0),h=c-d;return e.jsxs("div",{className:"payment-summary",children:[e.jsxs("div",{className:"payment-title",children:["ê²°ì œì •ë³´ (",s,"ê±´)"]}),e.jsx("div",{className:"order-summary-section",children:e.jsx("div",{className:"items-summary",children:a.map((l,n)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("div",{className:"item-info",children:e.jsx("span",{className:"item-name",children:l.productName})}),e.jsxs("span",{className:"item-price",children:[(l.price*l.quantity).toLocaleString(),"ì›"]})]},n))})}),e.jsx("div",{className:"payment-details",children:h>0&&e.jsxs("div",{className:"payment-row discount",children:[e.jsx("span",{children:"í• ì¸ê¸ˆì•¡"}),e.jsxs("span",{className:"discount-amount",children:["-",h?.toLocaleString(),"ì›"]})]})}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"ì´ ê²°ì œ ê¸ˆì•¡"}),e.jsxs("span",{className:"payment-total-price",children:[d?.toLocaleString(),"ì›"]})]})]})}function U({message:a,onRetry:s}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),e.jsx("p",{children:a}),e.jsx("button",{onClick:s,className:"payment-button",children:"ë‹¤ì‹œ ì‹œë„"})]})}function V(){const[a,s]=p.useState(null),[c,d]=p.useState({}),[h,l]=p.useState(null),[n,x]=p.useState(!0),[S,u]=p.useState(!1),[t,y]=p.useState(""),[C,I]=p.useState(!1),[R,w]=p.useState(!1),[E,M]=p.useState(!1),[D,$]=p.useState(""),f=a?.orderItems||[],P=f.reduce((i,r)=>i+r.price*r.quantity,0);p.useEffect(()=>(O(),window.processPaymentImmediately=G,w(!0),()=>{delete window.processPaymentImmediately}),[]);const O=async()=>{try{l(null),x(!0);let i=sessionStorage.getItem("selectedCartItems"),r=null;if(i)r=JSON.parse(i);else try{const o=await fetch("/order/session-state",{method:"GET",credentials:"include"});if(o.ok){const m=await o.json(),j=m.body||m;if(j.cartItemIds&&j.cartItemIds.length>0){const N=await fetch(`/cart/items?ids=${j.cartItemIds.join(",")}`,{method:"GET",credentials:"include"});if(N.ok){const k=await N.json();r=k.body||k,sessionStorage.setItem("selectedCartItems",JSON.stringify(r))}}}}catch(o){console.log("ì„œë²„ ì„¸ì…˜ ìƒíƒœ ë³µì› ì‹¤íŒ¨:",o)}if(!r||r.length===0){alert("ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”."),window.location.href="/cart";return}try{const o=await fetch("/order/member-info",{method:"GET",credentials:"include"});if(o.ok){const m=await o.json(),j=m.body||m;d({name:j.name||"",phone:j.tel||"",email:j.email||""})}else d({name:"",phone:"",email:""})}catch{d({name:"",phone:"",email:""})}s({orderItems:r})}catch{l("ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}finally{x(!1)}},J=async i=>{try{u(!0);const r=await q.createOrder({...i,totalAmount:T(i.items)});r&&r.success?await L(r.orderId,i.paymentMethod):alert(r?.message||"ì£¼ë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(r){console.error("ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨:",r),alert("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{u(!1)}},L=async(i,r)=>{try{u(!0);const o=T(a.items),m=await q.processPayment({orderId:i,paymentMethod:r,amount:o});m&&m.success?(alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${i}`):alert(m?.message||"ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(o){console.error("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",o),alert("ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{u(!1)}},T=i=>i.reduce((r,o)=>r+o.price*o.quantity,0),A=i=>{y(i)},G=async i=>{try{I(!0),u(!0),await new Promise(r=>setTimeout(r,1500)),alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(r){console.error("ì„ì‹œ ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",r),alert("ì„ì‹œ ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{I(!1),u(!1)}},B=async()=>{if(!t){alert("ê²°ì œ ìˆ˜ë‹¨ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return}try{u(!0);const i={cartItemIds:f.map(o=>o.cartItemId),ordererName:c.name||"",phone:c.phone||"",email:c.email||"",requirements:D||"",paymentMethod:t,totalAmount:P},r=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(r.ok){const o=await r.json();if(o.header&&o.header.rtcd!=="S00")throw new Error(o.header.rtmsg||"ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");const m=o.body||o,j=m.orderCode||m.data?.orderCode;j&&await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderCode:j,paymentMethod:t})}),M(!0),setTimeout(()=>{sessionStorage.removeItem("selectedCartItems"),window.updateCartCount&&window.updateCartCount();const N=m.orderCode||m.data?.orderCode;N?window.location.href=`/order/complete?orderCode=${N}`:(alert("ì£¼ë¬¸ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ë¬¸ë‚´ì—­ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”."),window.location.href="/mypage/orders")},2e3)}else{const o=await r.json().catch(()=>({})),m=o.header?.rtmsg||o.message||`ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${r.status} ${r.statusText}`;alert(m)}}catch{alert("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}finally{u(!1)}};return n?e.jsx("div",{className:"order-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"custom-spinner"}),e.jsx("div",{className:"loading-text",children:"ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}):h?e.jsx("div",{className:"order-container",children:e.jsx(U,{message:h,onRetry:O})}):a?e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/cart",className:"continue-shopping-btn",children:"< ì¥ë°”êµ¬ë‹ˆë¡œ ëŒì•„ê°€ê¸°"})}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx(K,{orderItems:f,memberInfo:c,onSubmit:J,loading:S,onPaymentMethodChange:A,paymentMethod:t,onRequirementsChange:$})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(Q,{items:f})})]}),e.jsxs("div",{className:"order-notice",children:[e.jsx("div",{className:"notice-item",children:"â€» ê´€ê´‘ ìƒí’ˆì€ ì˜ˆì•½ í™•ì • í›„ ì·¨ì†Œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤."}),e.jsx("div",{className:"notice-item",children:"â€» ë‚ ì”¨ë‚˜ í˜„ì§€ ì‚¬ì •ìœ¼ë¡œ ì¸í•œ ë³€ê²½ ì‹œ ì‚¬ì „ì•ˆë‚´ ë“œë¦½ë‹ˆë‹¤."}),e.jsx("div",{className:"notice-item",children:"â€» ê²°ì œ í›„ ì˜ˆì•½ í™•ì • ì•ˆë‚´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]}),e.jsx("div",{className:"order-bottom",children:e.jsxs("button",{onClick:B,className:"full-payment-button",disabled:!f.length,children:[P?.toLocaleString(),"ì› ê²°ì œí•˜ê¸°"]})}),R&&e.jsx("div",{className:"modal-overlay",onClick:()=>w(!1),children:e.jsxs("div",{className:"modal-content",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"ì•Œë¦¼"}),e.jsx("button",{className:"modal-close",onClick:()=>w(!1),children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("p",{children:["íšŒì› ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.",e.jsx("br",{}),"(íšŒì› ì •ë³´ ìˆ˜ì •ì€ ë‚´ ì •ë³´>íšŒì› ì •ë³´ ê´€ë¦¬ì—ì„œ ê°€ëŠ¥)"]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"modal-confirm-btn",onClick:()=>w(!1),children:"í™•ì¸"})})]})}),E&&e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"loading-modal-content",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"custom-spinner"}),e.jsxs("div",{className:"loading-text",children:["ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.",e.jsx("br",{}),"ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."]})]})})})]}):e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/cart",className:"continue-shopping-btn",children:"< ì¥ë°”êµ¬ë‹ˆë¡œ ëŒì•„ê°€ê¸°"})}),e.jsx("p",{children:"ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}F.createRoot(document.getElementById("order-root")).render(e.jsx(z.StrictMode,{children:e.jsx(V,{})}));
